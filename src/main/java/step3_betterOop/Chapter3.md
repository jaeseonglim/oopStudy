# 역할, 책임, 협력
- 객체지향은 객체들이 협력하여 공동체를 구성하는 것이다.
- 협력을 구성하기 위해선, 적절한 `책임`을 적절한 객체에게 부여하는 것.
- 어떤 협력이 필요하고, 협력을 위해 어떤 역할과 `책임`이 필요한지 고민해보아야 함.

## 협력
- 기능 구현을 위해 객체간 메시지를 주고받는 상호작용
- 객체는 다른 객체의 내부에 접근할 수 없기 때문에 메시지 전송을 통해 자신의 요청을 수행하도록 전달한다.
- 메시지를 수신한 객체는 자신의 일을 어떻게 스스로 처리할지 정할 수 있다. 그로인해 자율적인 객체를 보장하게 된다.
    - 자율적인 객체란 자신의 상태를 직접 관리하고, 스스로 행동하는 객체로써, 캡슐화를 통해 응집도가 높은 객체라고 볼 수 있다.
        
### 협력이 설계를 위한 문맥을 결정한다.
- "어떤 객체도 섬이 아니다"라는 워드 커닝헴과 켄트 벡의 말이 있는데 이 말은 객체지향 시스템에 참여하는 모든 객체들은
 어떤 형태로든 관계들로 엮여 있다. 객체를 노드로 하고 관계를 엣지로 나타내면 단 한 덩어리의 연결 그래프가 되어야만 한다.
 만약 어떤 객체가 다른 어떤 객체와도 관계를 갖지 않는다면 그 객체는 별도의 시스템이다.
 
- 객체가 가질 수 있는 상태와 행동을 어떤 기준으로 결정해야할까?
    - 객체가 참여하고 있는 협력을 통해 결정해야 한다.
    - 협력안에서 객체가 처리할 메시지로 행동이 결정된다.
    - 상태 또한 협력에 필요한 행동들이 어떤 정보가 필요한지에 의해 결정된다.
    - Movie가 있고 영화 상영을 한다 했을때 Movie의 행동을 결정하는 것은 예매를 위한 협력이다.
    - 협력이라는 문맥을 고려하지 않고 Movie의 행동을 결정하는 것은 아무런 의미가 없다.
    
- 묻지 말고 시켜라(Tell, Don't Ask)
    - 훌륭한 메시지는 객체의 상태에 관해 묻지 말고 원하는 것을 시켜야 한다.
    - 외부에서 해당 객채의 상태를 결정 내리는 것은 캡슐화를 위반.
    - 절차적인 코드는 정보를 얻은 후에 결정한다. 객체지향 코드는 객체에게 그것을 하도록 시킨다. 
    - 내부의 상태를 이용해 어떤 결정을 내리는 로직이 객체 외부에 존재한다면 해당 객체가 `책임`져야 하는 어떤 행동이 객체 외부로 누수된것.
    - 상태를 묻는 오퍼레이션 -> 행동을 요청하는 오퍼레이션으로

- 디미터의 법칙
    - 객체에 묻지(getter) 말고 시키자.
    - https://woowacourse.github.io/javable/2020-06-02/law-of-demeter
    - https://github.com/next-step/java-lotto/pull/601#discussion_r434681734
    
## 책임
### 책임이란 무엇인가?
- `책임`이란 객체에 의해 정의되는 응집도 있는 행위의 집합으로, 객체가 유지해야 하는 정보와 수행할 수 있는 행동.
- 즉, 객체가 '무엇을 알고 있는가'와 '무엇을 할 수 있는가' 로 구성된다.
- 하는것이란 해당 객체가 할 수 있는 행동 대한 책임.
- 아는것은 필요한 정보를 아는것, 내가 도움받을 객체를 아는것.

- Screening의 `책임`은 영화를 예매하는것, Movie의 `책임`은 요금을 계산하는것
```java
public class Screening {
    private final Movie movie;
    private final int sequence;
    private final LocalDateTime whenScreened;

    public Screening(final Movie movie, final int sequence, final LocalDateTime whenScreened) {
        this.movie = movie;
        this.sequence = sequence;
        this.whenScreened = whenScreened;
    }

    public Reservation reserve(Customer customer, int audienceCount) {
        return new Reservation(customer, this, calculateFee(audienceCount), audienceCount);
    }
}
```
- 객체는 자신이 맡은 `책임`을 수행하는데 필요한 정보를 알고 있을 `책임`이 있기에 Screening이 Movie를 인스턴스로 갖고 있는 이유중 하나.
- 객체지향에서 가장 중요한것은 `책임`

### 책임 할당
- 협력에 필요한 정보와 방법을 잘 알고 있는 객체에게 도움을 요청하면 도움을 요청받은 객체가 수행할 행동이 책임으로 이어진다.
- 영화 예매 시스템에서 '예매` 하는 기능을 어떤 객체에게 책임을 할당해야 하는지 예를 들면
    1. 메시지의 이름을 결정 => `예매하라`
    2. 메시지를 처리할 객체 선택 => `Screening` -> 가장 정보를 많이 알고 있는 Screening에게 할당
    3. 예매를 위해선 가격을 계산해야하는데 `Screening`은 정보가 부족하기 때문에 새로운 메시지로 다른 객체에게 요청 => `계산하라`
    4. 가격을 계산하는데 필요한 정보를 알고있는 객체 선택 => `Movie`에게 책임을 할당   
- 이처럼 OOP는 협력에 필요한 메시지를 찾고 메시지를 수행할 적절한 객체를 선택하는 과정.
- 이런 과정을 통해 퍼블릭 인터페이스를 구성하게 될 수 있다는 것도 알아두자.
  
### 책임 주도 설계  
- 프로그래밍의 책임을 찾고 책임을 수행할 적절한 객체를 찾아 책임을 할당하는 방식으로 협력을 설계하는 방법
- 책임 주도 설계 과정
    - 시스템이 사용자에게 제공해야 하는 기능인 시스템 책임을 파악한다.
    - 시스템 책임을 더 작은 책임으로 분할한다.
    - 분할된 책임을 수행할 수 있는 적절한 객체 또는 역할을 찾아 책임을 할당한다.
    - 객체가 책임을 수행하는 도중 다른 객체의 도움이 필요한 경우 이를 책임질 적절한 객체 또는 역할을 찾는다.
    - 해당 객체 또는 역할에게 책임을 할당함으로써 두 객체가 협력하게 한다.

- 책임 주도 설계는 자연스럽게 객체의 구현이 아닌 책임에 집중할 수 있게 한다.
- 구현이 아닌 책임에 집중하는 것이 중요한 이유는 유연하고 견고한 객체지향 시스템을 위해 가장 중요한 재료가 바로 책임이기 때문이다.

### 메시지가 객체를 결정한다.
- 책임을 할당할 때 고려해야하는 두가지 요소가 존재하는데 그중에 하나는 `메시지가 객체를 결정하는 것`
- 객체가 메시지를 선택하는 것이 아닌 메시지가 객체를 선택한다.
    1. 최소한의 크기를 가진 인터페이스를 가진다.
    2. 추상적인 인터페이스를 가진다. 인터페이스는 계약서, 약속이기 때문에 무엇을 하는지에 대해 알려주기만 한다.
    메세지를 먼저 식별하면 무엇을 수행할지에 초점을 맞추는 인터페이스를 얻을 수 있다.
    
### 행동이 상태를 결정한다.
- 객체의 행동은 협력에 참여하는 방법이다.
- 절차지향의 특징은 데이터를 중심으로 구현하고 객체지향의 특징은 기능 중심으로 구현한다.
- 캡슐화를 위반 하지 않도록 구현에 대한 결정을 뒤로 미루면서 객체의 행위를 고려하기 위해서는 항상 협력이라는 문맥안에서 객체를 생각해야한다.
- 즉, 객체간 무엇을 제공하고 무엇을 얻어야 하는지 고민하고 상태는 행동을 정상적으로 수행하기 위한 재료이다.

## 역할
### 역할과 협력
- 객체가 어떤 협력 안에서 수행하는 책임의 집합을 `역할`이라고 부른다.
- `역할`은 다른 것으로 교체할 수 있는 `책임의 집합` 이다. = 인터페이스로 도출할 수 있다.
- 예로 예매 시스템에는 두가지 할인 정책이 있는데, `계산하라` 라는 메시지에 둘다 응답할 수 있어야 한다.
    - 하지만 두 객체를 협력하려고 하면 중복 코드가 발생하게 될것.
    - 계산이라는 동일한 책임을 수행하고 있기에 대표자를 통해 교대로 교체할 수 있도록 추상화를 한다.
    - `역할`은 동일한 책임을 수행하는 여러 객체들을 하나로 통합할 수 있도록 일종의 슬롯이라고 볼 수 있다.

### 객체 VS 역할
- 한 종류의 객체만 협력에 참여한다면 역할을 고려해야할까?
-> 동일한 객체가 동일한 역할을 수행한다면 둘은 동일한 것.
-> 결론은 협력을 수행하는 대상이 한 종류라면 객체로 간주하고 여러 종류의 객체들이 참여한다면 역할이라고 부른다.

- 역할을 세우기 어렵다면 협력을 위해 어떤 책임이 필요한지 이해하는것이 중요하다.
- 다양한 객체들이 협력에 참여한다면 역할을 고려해보는것이 좋다.

### 역할과 추상화
- 역할은 협력을 추상화 한다.
- 각 개인적으로 생각하는 추상화란?
    -> 여러가지 요구사항을 수집하여 각 요구사항에서 공통점을 추출하고 차이점을 감추는 과정이라고 생각합니다.
- 역할은 동일한 협력을 수행하는 객체들을 공통의 책임을 바탕으로 객체의 종류를 숨기기 때문에 객체의 추상화라고 볼 수 있다.
    - 계산하는 공통 책임을 DiscountPolicy 라는 인터페이스를 통해 추상화 한 것을 예로 들 수 있다.
- 추상화의 장점
    1. 세부 사항에 억눌리지 않고 상위 수준의 정책을 쉽고 간단하게 표현 가능
    2. 설계를 유연하게 만들 수 있다. 다양한 객체들을 수용할 수 있게 해주므로 협력을 유연하게 만든다.

### 배우와 배역
- 배우가 여러 연극에 참여하며 여러 배역을 연기하는것 처럼 객체 또한 여려 협력에 참여하면서 다양한 역할을 수행한다.


--------------------
공통적인 행동
추상화를 통해 여러 역할을 분리

생물           - 움직인다, 먹는다
 |    |  ㄴ 나무 
 사람  개   
두다리 네다리 null

-------------------
협력을 우선시하고 역할은 나중에
