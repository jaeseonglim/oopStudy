# 상속과 코드 재사용
## 01. 상속과 중복 코드
### DRY 원칙
- 중복 코드는 변경을 방해한다.
- 신롸할 수 있고 수정하기 쉬운 SW를 만드는 효과적인 방법은 중복을 제거하는 것인데, DRY 원칙을 따라야한다.
- DRY라는 뜻은 Don't Repeat Yourself, 반복하지 마라 라는 뜻이다.
- 현재 챕터에서 설명된 코드를 보면, 할인 요금을 시간마다 다르게 적용하기 위해 Phone 클래스와 NightlyDiscountPhone 클래스 각 내부에 <br>
  할인하는 요금만 다를뿐 요금 할인에 대한 코드가 중복해서 존재하게 된다.
    - 만약 핸드폰에 따라 통화 요금에 부과할 세금을 적용하여 계산하도록 한다면 어떻게 될까?

### 중복 코드 수정하기
- 중복 코드는 항상 함께 수정되어야 하기 때문에 서로 다르게 수정된다면 치명적인 버그가 발생하게 될것이다.
- 중복 코드를 제거하지 않은 상태에서 코드를 수정하는 유일한 방법은 새로운 중복 코드를 추가하는것이다.
    - but, 중복 코드는 중복 코드를 낳는다.
- 중복 코드를 추가하는 대신 제거하여 DRY하게 만들자.

### 타입코드 사용하기
- Phone 클래스와 NightlyDiscountPhone 클래스의 중복 코드를 제거하는 방법은 클래스를 하나로 합치는 것이다.
    - 요금제를 구분하는 타입 코드를 추가하고, 타입 코드의 값에 따라 로직을 분기시켜 합칠 수 있다.
    - 다만 타입코드를 사용하는 클래스는 낮은 응집도와 높은 결합도를 가질 문제가 존재한다.
- 상속을 통해 타입 코드를 사용하지 않고 중복 코드를 관리할 수 있다.

### 상속을 이용해서 중복 코드 제거하기
- 상속을 사용하면 중복되는 내용을 상당수 제거할 수 있고, 코드 대부분을 재사용할 수 있다.
- 상속을 이용해 코드를 재사용하기 위해서는 부모 클래스의 개발자가 세웠던 가정이나 추론과정을 정확하게 이해해야 한다. 
- 이것은 자식 클래스의 작성자가 부모 클래스의 구현 방법에 대한 정확한 지식을 가져야 한다는 것을 의미한다.
- 따라서 상속은 결합도를 높인다. == 수정하기가 어렵다.

### 강하게 결합된 Phone 과 NightlyDiscountPhone
- 자식클래스의 메서드 안에서 super 참조를 이용해 부모 클래스의 메서드를 직접 호출할 경우 두 클래스는 강하게 결합된다.
- super 호출을 제거할 수 있는 방법을 찾아 결합도를 제거하라.

## 02. 취약한 기반 클래스 문제
- 부모 클래스의 변경에 의해 자식 클래스가 영향을 받는 현상을 취약한 기반 클래스 문제라고 부른다
- 상속은 자식 클래스를 점진적으로 추가해서 기능 확장하는데 용이하지만, 상속 관계를 추가할수록 시스템의 결합도가 높아진다.
- 자식 클래스가 부모의 세부 구현사항에 의존하도록 만들어지기 때문에, 캡슐화를 약화시키기 때문에 상속을 피해야한다.

### 상속이 가지는 구체적인 문제점
1. 불필요한 인터페이스 상속 문제
    - JCF의 Stack이 대표적인 예이다. Stack은 Vector를 상속받고 있는데, Vector는 리스트 자료 구조이고 Stack은 LIFO 자료구조이다.
    - 부모의 임의의 인덱스에서 조회, 추가 삭제가 가능한 설계를 상속받았기 때문에 Stack의 LIFO 규칙을 쉽게 위반할 수 있다.
    - **상속받은 부모 클래스의 메서드가 자식 클래스의 내부 구조에 대한 규칙을 깨뜨릴 수 있다.**
2. 메서드 오버라이딩의 오작용 문재
    - 이펙티브 자바 3편 아이템 16 계승하는 대신 구성하라
    - 자식 객체에서 부모의 메서드를 호출할 때, 첫번째로 자식 클래스에서 메서드를 찾고, 없으면 부모 클래스에서 찾는다.
    - **자식 클래스가 부모 클래스의 메서드를 오버라이딩할 경우 부모 클래스가 자신의 메서드를 사용하는 방법에 자식 클래스가 결합될 수 있다.**
3. 부모 클래스와 자식 클래스의 동시 수정 문제
    - 상속을 사용하면 자식 클래스가 부모 클래스의 구현에 강하게 결합되기 때문에 클래스를 상속하면 <br>
    결합도로 인해 자식 클래스와 부모 클래스의 구현을 영원히 변경하지 않거나 자식 클래스와 부모 클래스를 동시에 변경해야 한다.

## 03. Phone 다시 살펴보기
### 추상화에 의존하자.
- 위와 같은 문제점들을 해결하기 위해선 **자식 클래스와 부모 클래스가 동시에 추상 클래스에 의존하도록 하는것이다.**
- 추상화에 의존한다는 말은 자식클래스가 부모클래스의 구현에 의존하는 것이 아니라 추상화에 의존하도록 변경해야 한다. 이를 위한 순서는 다음과 같다.
1. 차이를 메서드로 추출하라
    - 두 메서드가 유사하게 보인다면 차이점을 메서드로 추출하라. 중복 코드 안에서 별도의 메서드로 추출하는 것이다.
    - 변하는 것으로부터 변하지 않는 것을 분리하라.
    - 메서드 추출을 통해 두 메서드를 동일한 형태로 보이도록 만들 수 있다.
2. 중복 코드를 부모 클래스로 올려라
    - 부모 클래스의 코드를 하위로 내리지말고 자식 클래스의 코드를 상위로 올리도록 한다.
    - 자식 클래스들 사이의 공통점을 부모 클래스로 옮김으로써 자식 클래스들은 서로 다른 변경의 이유를 가지게 된다.

### 추상화가 핵심이다.
- 상속 계층을 진화하는데 있어서 걸림돌이 있다면 추상화를 찾아내고 상속 계층 안의 클래스들이 추상화에 의존하도록 리팩토링하자.
- 차이점을 메서드로 추출하고 공통적인 부분을 부모클래스로 이동시키자.
- 단일 책임 원칙을 준수하도록 변경되기 때문에 응집도가 높아지는 장점이 있다.
    - 확장에는 열려 있고 수정에는 닫혀 있기 때문에 OCP도 준수한다.
- 부모 클래스도 자신의 내부에 구현된 추상 메서드를 호출하기 때문에 추상화에 의존한다고 말할 수 있다.
    - 의존성 역전 원칙도 준수하게 된다.
- 상속 계층은 자식 클래스가 부모 클래스가 구현한 행동뿐만 아니라 인스턴스 변수에 대해서도 결합되게 만들기 때문에 <br>
  상속으로 인한 클래스 사이의 결합을 피할 수 있는 방법은 없다. 상속은 어떤 방식으로든 부모 클래스와 자식 클래스를 결합시킨다.

## 04. 차이에 의한 프로그래밍
- 중복 코드를 제거하고 코드를 재사용하는 것.
- 객체지향 세계에서 중복 코드를 제거하고 코드를 재사용할 수 있는 가장 유명한 방법은 상속이다. 기본 아이디어는 간단하다.
    - 여러 클래스에 공통적으로 포함돼 있는 중복코드를 하나의 클래스로 모은다.
    - 원래 클래스들에서 중복 코드를 제거한 후 중복 코드가 옮겨진 클래스를 상속 관계로 연결한다.
- 정말로 필요한 경우에만 상속을 사용하라. 상속은 코드 재사용과 관련된 대부분의 경우에 우아한 해결 방법이 아니다.
- 객체지향에 능숙한 개발자들은 상속의 단점을 피하면서도 코드를 재사용할 수 있는 더 좋은 방법이 있다는 사실을 알고 있다.
- 바로 `합성`이다.
